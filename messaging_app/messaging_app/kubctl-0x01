#!/bin/bash
set -e

DEPLOYMENT_NAME="django-app"   # change to your actual deployment name
SERVICE_NAME="django-service"  # change if your service name is different
NAMESPACE="default"            # change if you're using another namespace

echo "ðŸ”¹ Scaling $DEPLOYMENT_NAME to 3 replicas..."
kubectl scale deployment "$DEPLOYMENT_NAME" --replicas=3 --namespace="$NAMESPACE"

echo "ðŸ”¹ Waiting for pods to be ready..."
kubectl rollout status deployment "$DEPLOYMENT_NAME" --namespace="$NAMESPACE"

echo "ðŸ”¹ Current pods:"
kubectl get pods --namespace="$NAMESPACE"

# Get service URL from minikube
echo "ðŸ”¹ Getting service URL..."
SERVICE_URL=$(minikube service "$SERVICE_NAME" --url --namespace="$NAMESPACE")

echo "ðŸ”¹ Running load test with wrk..."
wrk -t4 -c50 -d10s "$SERVICE_URL"

echo "ðŸ”¹ Monitoring resource usage..."
kubectl top pods --namespace="$NAMESPACE"
