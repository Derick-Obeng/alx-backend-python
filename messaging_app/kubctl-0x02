#!/bin/bash
set -e

echo "ğŸš€ Deploying BLUE version..."
kubectl apply -f blue_deployment.yaml

echo "ğŸš€ Deploying GREEN version..."
kubectl apply -f green_deployment.yaml

echo "ğŸ“¡ Applying Service..."
kubectl apply -f kubeservice.yaml

echo "â³ Waiting for green pods to start..."
sleep 10

echo "ğŸ” Checking logs for GREEN deployment..."
GREEN_PODS=$(kubectl get pods -l app=django,version=green -o name)
for pod in $GREEN_PODS; do
    kubectl logs $pod || { echo "âŒ Error in $pod"; exit 1; }
done

echo "âœ… Green deployment running without errors. Ready to switch traffic."
